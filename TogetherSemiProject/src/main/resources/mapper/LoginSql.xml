<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.semi.mapper.LoginMapper">


	<insert id="insertUser" parameterType="UserDto">
		insert into user (uname,age,gender,email,pass,hp,city1,city2,category,inemail,joinday) values
		(#{uname},#{age},#{gender},#{email},#{pass},#{hp},#{city1},#{city2},#{category},#{inemail},now())
	</insert>
	
	<select id="isEqualPassEmail" parameterType="Map" resultType="int">
		select count(*) from user where email=#{email} and pass=#{pass}
	</select>
	
	<select id="selectOneOfEmail" parameterType="String" resultType="UserDto">
		select * from user where email=#{email}
	</select>

	<select id="overlappedEmail" parameterType="UserDto" resultType="int">
		select count(email) from user where email=#{email}
	</select>
	
<!-- 마이페이지 -->
	<select id="getMyMoimList" resultType="MoimDto">
		select * from moim where unum=#{unum}
	</select>
	<select id="getMyProfile" resultType="UserPhotoDto">
		select * from user_photo where unum=#{unum}
	</select>
	
	<update id="updateOtherphoto" parameterType="int">
		update user_photo set is_main = 0 where unum=#{unum}
	</update>
	<update id="updateMyPhoto" parameterType="UserPhotoDto">
		update user_photo set is_main = 0 where unum=#{unum};
 		 update user_photo set is_main = 1 where photo_idx = (select max(photo_idx) from user_photo where unum = #{unum});
	</update>
	<update id="updateMainphoto" parameterType="int">
		update user_photo set is_main = case when photo_idx = #{photo_idx} then 1 else 0 end
	</update>

	<select id="getJJimDto" resultType="JJimDto">
		select * from jjim where unum=#{mnum}
	</select>
	<select id="getMyJJImList" resultType="JJimDto">
		select * from jjim where unum=#{unum}
	</select>
	<select id="getJJimMoimList" resultType="JJimDto">
		select * from jjim where unum=#{unum}
	</select>

	<select id="getMyProfilePhotos" resultType="UserPhotoDto">
	  SELECT * FROM user_photo WHERE unum = #{unum}
	</select>
	<select id="getMypage" parameterType="int" resultType="UserDto">
		select * from user where unum=#{unum}
	</select>
	
	<select id="getAllUsers" resultType="UserDto">
		select * from user order by unum asc
	</select>

	<select id="getTotalCount" resultType="int">
		select count(*) from user
	</select>

	<insert id="insertMyPhoto" parameterType="UserPhotoDto">
	  insert into user_photo (unum, file_name) values
	  (#{unum}, #{file_name})
	</insert>
	
	<select id="getGaipMoimList" parameterType="int" resultType="Map">
		select m.mnum, m.mname from moim m join moimmember mm on m.mnum=mm.mnum where mm.unum=#{unum} and acceptcall=1;
	</select>
</mapper>