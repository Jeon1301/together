<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.semi.mapper.LoginMapper">

	<!-- UserPhotoDto에 대한 Result Map 추가 -->
	<resultMap type="com.semi.mapper.LoginMapper.UserPhotoDto" id="userPhotoResultMap">
	  <result column="photo_idx" property="photo_idx" />
	  <result column="unum" property="unum" />
	  <result column="file_name" property="file_name" />
	  <result column="upload_date" property="upload_date" />
	</resultMap>


<insert id="insertUser" parameterType="UserDto">
	insert into user (uname,age,gender,email,pass,hp,city1,city2,joinday) values
	(#{uname},#{age},#{gender},#{email},#{pass},#{hp},#{city1},#{city2},now())
</insert>

	<select id="getMypage" parameterType="int" resultType="UserDto">
		select * from user where unum=#{unum}
	</select>
	
	<select id="getAllUsers" resultType="UserDto">
		select * from user order by unum asc
	</select>

	<select id="getUserInfo" parameterType="int" resultType="UserDto">
		select * from user order where unum=#{unum}
	</select>

	<select id="getTotalCount" resultType="int">
		select count(*) from user
	</select>

<select id="isEqualPassEmail" parameterType="Map" resultType="int">
	select count(*) from user where email=#{email} and pass=#{pass}
</select>

<select id="selectOneOfEmail" parameterType="String" resultType="UserDto">
	select * from user where email=#{email}
</select>

	<select id="getUserPhotoList" parameterType="int" resultMap="userPhotoResultMap">
       SELECT unum, file_name
  		FROM user_photo
  		WHERE unum = #{unum}
    </select>
    	
    
    <insert id="insertUserPhoto" parameterType="UserPhotoDto">
        INSERT INTO user_photo (unum, file_name,file_type, upload_date) 
        VALUES (#{unum}, #{fileName}, #{fileType}, #{uploadDate})
    </insert>
    
    <delete id="deleteUserPhoto" parameterType="int">
        DELETE FROM user_photo WHERE photo_idx=#{photo_idx}
    </delete>
	

</mapper>