<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.semi.mapper.MoimMapper">
	<select id="getMaxNum" resultType="int">
		select ifnull(max(mnum),0) from moim
	</select>
	<select id="getTotalCount" resultType="int">
		select count(*) from moim
	</select>
	<select id="getAllMoim" resultType="MoimDto">
		select * from moim order by mnum asc
	</select>
	<insert id="insertMoim" parameterType="MoimDto">
		insert into moim (mname,jang,mphoto,mcontent,city1,city2,category,open,createday) values
		(#{mname},#{jang},#{mphoto},#{mcontent},#{city1},#{city2},#{category},#{open},now())
	</insert>
	<select id="getPagingList" parameterType="Map" resultType="MoimDto">
		select * from moim order by mnum desc limit #{start},#{perpage}
	</select>
	<select id="getCategoryPagingList" parameterType="Map" resultType="MoimDto">
		select * from moim where category=#{category} order by mnum desc limit #{start},#{perpage}
	</select>
	<select id="getData" parameterType="int" resultType="MoimDto">
		select * from moim where mnum=#{mnum}
	</select>
	<delete id="deleteMoim" parameterType="int">
		delete from moim where mnum=#{mnum}
	</delete>
	<update id="updateMoim" parameterType="MoimDto">
		update moim set mname=#{mname}
		<if test="mphoto!=''">
			,mphoto=#{mphoto}
		</if>
		,mcontent=#{mcontent} where mnum=#{mnum}
	</update>
	<select id="overlappedMname" parameterType="MoimDto" resultType="int">
		select count(mname) from moim where mname=#{mname}
	</select>
	<insert id="updateJjimcount" parameterType="Map">
		insert into jjim (unum, mnum) values (#{unum}, #{mnum})
	</insert>
	<select id="pressJjim" parameterType="Map" resultType="int">
		select count(*) from jjim where unum=#{unum} and mnum=#{mnum}
	</select>
	<delete id="deleteJjim" parameterType="Map">
		delete from jjim where unum=#{unum} and mnum=#{mnum}
	</delete>
	<insert id="moimGaip" parameterType="Map">
		insert into moimmember (unum, mnum) values (#{unum}, #{mnum})
	</insert>
	<delete id="deleteGaip" parameterType="Map">
		delete from moimmember where unum=#{unum} and mnum=#{mnum}
	</delete>
	<select id="pressGaip" parameterType="Map" resultType="int">
		select count(*) from moimmember where unum=#{unum} and mnum=#{mnum}
	</select>
</mapper>














